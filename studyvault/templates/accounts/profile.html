{% extends "base.html" %}
{% block title %}Profile — StudyVault{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-10">
  <div class="bg-white border rounded-2xl shadow-lg p-8">

    <h1 class="text-2xl font-semibold mb-6 text-center">My Profile</h1>

    <form method="post" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}
    
    <!-- Heading + user info + Edit button -->
<div class="flex items-center justify-between mb-6">
  <div>
    <h1 class="text-2xl font-semibold">{{ user.username }}</h1>
    <p class="text-gray-600">{{ user.email }}</p>
  </div>

  <button type="button" id="edit-toggle"
          class="px-4 py-2 rounded-md border hover:bg-black hover:text-white">
    Edit
  </button>
</div>


      <!-- Avatar -->
      <div class="text-center">
        {% if profile.avatar %}
          <img src="{{ profile.avatar.url }}" alt="Avatar" class="w-32 h-32 rounded-full mx-auto border mb-3 object-cover">
        {% else %}
          <div class="w-32 h-32 rounded-full mx-auto bg-gray-200 border mb-3 flex items-center justify-center text-gray-500 text-sm">
            No Photo
          </div>
        {% endif %}
        <label id="avatar-change-label"
       for="{{ form.avatar.id_for_label }}"
       class="cursor-pointer inline-block text-sm text-blue-600 hover:underline">
  Change Photo
</label>
{{ form.avatar }}

</div>

     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
  <div>
    {{ form.university.label_tag }}
    {{ form.university }}
  </div>
  <div>
    {{ form.department.label_tag }}
    {{ form.department }}
  </div>
</div>

<div>
  {{ form.subject.label_tag }}
  {{ form.subject }}
</div>

<div>
  {{ form.bio.label_tag }}
  {{ form.bio }}
</div>






      <div class="text-center">
        <button type="submit" class="px-5 py-2 bg-black text-white rounded hover:bg-gray-800 transition">
          Save Changes
        </button>
      </div>
    </form>
  
  <script>
document.addEventListener("DOMContentLoaded", function () {
  const editBtn   = document.getElementById("edit-toggle");
  const form      = document.querySelector("form");
 
  const avatarInput = form.querySelector("#id_avatar");
  const avatarLabel = document.getElementById("avatar-change-label");

// শুরুতেই Change Photo হাইড থাকবে
if (avatarLabel) avatarLabel.classList.add("hidden");
if (avatarInput) avatarInput.setAttribute("disabled", "disabled");


 
  const fields    = [
    form.querySelector("#id_university"),
    form.querySelector("#id_department"),
    form.querySelector("#id_subject"),
    form.querySelector("#id_bio")
  ].filter(Boolean);
  const submitBtn = form.querySelector('button[type="submit"]');

  // শুরুতে: ফর্ম readonly, submit বাটন লুকানো
  submitBtn.classList.add("hidden");

  function setDisabled(disabled) {
    fields.forEach(f => f && f.toggleAttribute("disabled", disabled));
    submitBtn.classList.toggle("hidden", disabled);
    
    if (avatarInput) avatarInput.toggleAttribute("disabled", disabled);
    if (avatarLabel) avatarLabel.classList.toggle("hidden", disabled);

  }

  // Edit টগল
  editBtn.addEventListener("click", function () {
    const nowDisabled = fields[0]?.hasAttribute("disabled");
    // যদি disabled থাকে → enable করো; নাহলে আবার disable
    setDisabled(!nowDisabled);
    editBtn.textContent = nowDisabled ? "Cancel" : "Edit";
    if (nowDisabled && fields[0]) fields[0].focus();
  });
});
</script>


  </div>
</div>
{% endblock %}
